4. SELECT и специальные условия отбора
Иногда довольно справедливо говорят, что SQL -- это команда SELECT. Это самая важная команда, которая позволяет извлечь из базы данных нужную нам информацию очень гибкими способами. Поэтому для эффективной работы с базами данных надо прежде всего хорошо изучить эту команду.

4.1. Отказ от дублирования

Если в список полей, добавляемых в результирующий набор, не входит ключевое поле, то в полученном наборе могут встретиться одинаковые записи. Чтобы избежать дублирования, перед списком полей надо поставить ключевое слово DISTINCT:

SELECT DISTINCT список-полей FROM имя-таблицы;

Команда с предикатом DISTINCT выдаст результат, из которого удалены дублированные значения.

4.2. Специальные условия отбора

Язык SQL, в дополнение к обычным операциям сравнения, позволяет проводить специальные проверки. В частности, можно проверить, входит ли определенное значение в явно заданное множество величин. Для этого используется запись:

значение IN (список-значений)

Список значений представляет собой последовательность элементов, разделённых запятыми. Если значение в левой части выражения совпадает с одним из этих элементов, выражение считается истинным. Например:

SELECT * FROM Region WHERE RegionDescription IN ('Eastern', 'Western'); 
Если значение поля RegionDescription равно 'Eastern' или 'Western', выражение считается истинным.

Для числовых величин удобно задать начальную и конечную границы диапазона, в который должно попасть проверяемое значение. Для этого используется ключевое слово BETWEEN:

значение BETWEEN нижняя-граница AND верхняя-граница

Например:

SELECT * FROM Products
WHERE UnitPrice BETWEEN 18.0 AND 21.35;
Значение поля UnitPrice должно лежать в диапазоне от 19,0 до 21,35.

Границы диапазона входят в него. Если значение поля UnitPrice в точности равно 21,35, результат приведенного выше сравнения будет истинным.

Для анализа строк предназначена операция LIKE. Она проверяет, имеется ли в анализируемом значении указанная подстрока:

значение-строки LIKE шаблон

Значение строки проверяется на соответствие шаблону. В шаблоне используют обычные символы, а также два специальных: знак подчеркивания _ и знак процента %.

Знак подчеркивания означает, что в данном месте может находиться любой отдельный символ. Знак процента заменяет строку произвольной, в том числе нулевой, длины.

Например:

SELECT * FROM Territories WHERE TerritoryDescription LIKE 'New %'; 


Если надо проверить наличие в строке самих знаков _ или %, перед ними указывают символ наклонной черты /. Следующее выражение истинно:

'100%' LIKE '100/%'

Символ наклонной черты в шаблоне необходимо повторить дважды, как, например, в следующем истинном выражении:

'/' LIKE '//'

4.3. Задания

4.3.1. Найдите всех пользователей (Customers), фамилия контактной персоны которых (ContactName) начинается с C.

4.3.2. Найдите все заказы, плата за груз у которых (Freight) лежит в диапазоне от 100 до 200, а страна-поставщик ShipCountry -- либо USA, либо France.

4.3.3. Отфильтруйте таблицу EmployeeTerritories, задающую отношение многие-ко-многим между сотрудниками и территориальными подразделениями, так, чтобы значение связующего поля TerritoryID находилось в промежутке от 6897 до 31000.

Решение задания 3
3.9.1. Напишите запрос, формирующий полный список товаров (Products) и выводящий название товара и количество единиц на складе.
SELECT ProductName, UnitsInStock FROM Products
3.9.2. Напишите запрос, формирующий список товаров (Products) и выводящий название товара и цену для тех товаров, которые дешевле 20.
SELECT ProductName, UnitPrice FROM Products
WHERE UnitPrice < 20
3.9.3. Выведите список заказов, у которых плата за груз лежит в диапазоне от 11.7 до 98.1.
SELECT * FROM Orders
WHERE Freight >= 11.7 and Freight <= 98.1
3.9.4. Отберите всех сотрудников (Employees) - мужчин (анализируйте поле TitleOfCourtesy).
SELECT * FROM Employees
WHERE TitleOfCourtesy = 'Dr.' or TitleOfCourtesy = 'Mr.'
3.9.5. Отберите всех поставщиков (Suppliers) из Японии.
SELECT * FROM Suppliers
WHERE Country = 'Japan'
3.9.6. Отберите все заказы, для которых идентификатор сотрудника-исполнителя равен 2, 4 или 8.
SELECT * FROM Orders
WHERE EmployeeID = 2 or EmployeeID = 4 or EmployeeID = 8
3.9.7. Выведите идентификаторы заказов и товаров из таблицы Order Details, для которых цена больше 40, а количество (Quantity) меньше 10.
SELECT OrderID, ProductID 
FROM [Order Details]
WHERE UnitPrice > 40 and Quantity < 10